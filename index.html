<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ArcadeDoodle - Playful Mini Games</title>
    <style>
        /* ====== STYLE ====== */
        :root {
            /* Colors */
            --bg-1: #f8f9fa;
            --bg-2: #ffffff;
            --surface: #ffffff;
            --elev-1: #f1f3f4;
            --accent-primary: #4285f4;
            --accent-2: #34a853;
            --accent-3: #fbbc04;
            --success: #34a853;
            --warn: #fbbc04;
            --danger: #ea4335;
            --text-primary: #202124;
            --muted: #5f6368;
            
            /* Typography */
            --font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, "Helvetica Neue", Arial, sans-serif;
            --h1-size: 2.5rem;
            --body-size: 1rem;
            
            /* Spacing */
            --space-xs: 0.5rem;
            --space-sm: 1rem;
            --space-md: 1.5rem;
            --space-lg: 2.5rem;
            
            /* Radii & Shadows */
            --radius: 16px;
            --radius-sm: 8px;
            --shadow-1: 0 2px 10px rgba(0, 0, 0, 0.1);
            --shadow-2: 0 4px 20px rgba(0, 0, 0, 0.15);
            
            /* Motion */
            --ease: cubic-bezier(0.4, 0, 0.2, 1);
            --spring: cubic-bezier(0.68, -0.55, 0.27, 1.55);
        }

        .theme-dark {
            --bg-1: #202124;
            --bg-2: #303134;
            --surface: #303134;
            --elev-1: #3c4043;
            --text-primary: #e8eaed;
            --muted: #9aa0a6;
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: var(--font-family);
            background: linear-gradient(135deg, var(--bg-1), var(--bg-2));
            color: var(--text-primary);
            min-height: 100vh;
            display: flex;
            flex-direction: column;
            align-items: center;
            padding: var(--space-md);
            line-height: 1.5;
        }

        @media (prefers-reduced-motion: reduce) {
            * {
                animation-duration: 0.01ms !important;
                animation-iteration-count: 1 !important;
                transition-duration: 0.01ms !important;
            }
        }

        .app-container {
            width: 100%;
            max-width: 1000px;
            background: var(--surface);
            border-radius: var(--radius);
            box-shadow: var(--shadow-2);
            overflow: hidden;
            position: relative;
        }

        /* Header Styles */
        .app-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: var(--space-md);
            background: var(--accent-primary);
            color: white;
        }

        .logo {
            display: flex;
            align-items: center;
            gap: var(--space-sm);
        }

        .logo-icon {
            width: 36px;
            height: 36px;
            background: white;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: bold;
            color: var(--accent-primary);
        }

        .header-controls {
            display: flex;
            gap: var(--space-sm);
        }

        .icon-button {
            width: 40px;
            height: 40px;
            border-radius: 50%;
            border: none;
            background: rgba(255, 255, 255, 0.2);
            color: white;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: background 0.2s var(--ease);
        }

        .icon-button:hover {
            background: rgba(255, 255, 255, 0.3);
        }

        /* Main Content */
        .main-content {
            padding: var(--space-md);
        }

        .search-bar {
            display: flex;
            margin-bottom: var(--space-md);
            position: relative;
        }

        .search-input {
            flex: 1;
            padding: var(--space-sm) var(--space-lg) var(--space-sm) var(--space-sm);
            border: 2px solid var(--elev-1);
            border-radius: var(--radius);
            font-size: var(--body-size);
            background: var(--surface);
            color: var(--text-primary);
        }

        .search-icon {
            position: absolute;
            right: var(--space-sm);
            top: 50%;
            transform: translateY(-50%);
            color: var(--muted);
        }

        /* Game Grid */
        .games-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(250px, 1fr));
            gap: var(--space-md);
        }

        .game-tile {
            background: var(--surface);
            border-radius: var(--radius);
            box-shadow: var(--shadow-1);
            padding: var(--space-md);
            display: flex;
            flex-direction: column;
            align-items: center;
            cursor: pointer;
            transition: transform 0.3s var(--spring), box-shadow 0.3s var(--ease);
            position: relative;
            overflow: hidden;
        }

        .game-tile:hover {
            transform: translateY(-5px);
            box-shadow: var(--shadow-2);
        }

        .game-tile:hover .tile-doodle {
            animation: wiggle 0.5s var(--ease);
        }

        @keyframes wiggle {
            0%, 100% { transform: rotate(0); }
            25% { transform: rotate(-5deg); }
            75% { transform: rotate(5deg); }
        }

        .tile-doodle {
            width: 80px;
            height: 80px;
            margin-bottom: var(--space-sm);
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 3rem;
        }

        .tile-title {
            font-weight: bold;
            margin-bottom: var(--space-xs);
        }

        .tile-subtitle {
            color: var(--muted);
            font-size: 0.9rem;
            text-align: center;
        }

        /* Ripple effect */
        .ripple {
            position: absolute;
            border-radius: 50%;
            background: rgba(255, 255, 255, 0.4);
            transform: scale(0);
            animation: ripple 0.6s var(--ease);
        }

        @keyframes ripple {
            to {
                transform: scale(4);
                opacity: 0;
            }
        }

        /* Game Container */
        .game-container {
            display: none;
            padding: var(--space-md);
            background: var(--surface);
            border-radius: var(--radius);
            margin-top: var(--space-md);
        }

        .game-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: var(--space-md);
        }

        .game-title {
            font-size: 1.5rem;
            font-weight: bold;
            color: var(--accent-primary);
        }

        .game-controls {
            display: flex;
            gap: var(--space-sm);
        }

        /* Buttons */
        .btn {
            padding: var(--space-sm) var(--space-md);
            border: none;
            border-radius: var(--radius);
            background: var(--accent-primary);
            color: white;
            font-weight: bold;
            cursor: pointer;
            transition: transform 0.2s var(--ease), box-shadow 0.2s var(--ease);
            display: inline-flex;
            align-items: center;
            gap: var(--space-xs);
            position: relative;
            overflow: hidden;
        }

        .btn:hover {
            transform: translateY(-2px);
            box-shadow: var(--shadow-1);
        }

        .btn:active {
            transform: translateY(0);
        }

        .btn-secondary {
            background: var(--elev-1);
            color: var(--text-primary);
        }

        /* Toast notifications */
        .toast-container {
            position: fixed;
            bottom: var(--space-md);
            left: 50%;
            transform: translateX(-50%);
            z-index: 1000;
            display: flex;
            flex-direction: column;
            gap: var(--space-sm);
        }

        .toast {
            padding: var(--space-sm) var(--space-md);
            background: var(--text-primary);
            color: var(--surface);
            border-radius: var(--radius);
            box-shadow: var(--shadow-2);
            animation: toast-in 0.3s var(--ease), toast-out 0.3s var(--ease) 2.7s forwards;
            display: flex;
            align-items: center;
            gap: var(--space-sm);
        }

        @keyframes toast-in {
            from { transform: translateY(100px); opacity: 0; }
            to { transform: translateY(0); opacity: 1; }
        }

        @keyframes toast-out {
            from { transform: translateY(0); opacity: 1; }
            to { transform: translateY(100px); opacity: 0; }
        }

        /* Confetti */
        .confetti {
            position: fixed;
            width: 10px;
            height: 10px;
            opacity: 0;
            pointer-events: none;
            z-index: 1000;
        }

        @keyframes confetti-fall {
            0% { transform: translateY(0) rotate(0deg); opacity: 1; }
            100% { transform: translateY(100vh) rotate(360deg); opacity: 0; }
        }

        /* Modal */
        .modal-overlay {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(0, 0, 0, 0.5);
            display: flex;
            align-items: center;
            justify-content: center;
            z-index: 1000;
            opacity: 0;
            pointer-events: none;
            transition: opacity 0.3s var(--ease);
        }

        .modal-overlay.active {
            opacity: 1;
            pointer-events: all;
        }

        .modal {
            background: var(--surface);
            border-radius: var(--radius);
            box-shadow: var(--shadow-2);
            width: 90%;
            max-width: 500px;
            max-height: 90vh;
            overflow-y: auto;
            padding: var(--space-md);
            transform: scale(0.9);
            transition: transform 0.3s var(--ease);
        }

        .modal-overlay.active .modal {
            transform: scale(1);
        }

        .modal-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: var(--space-md);
        }

        .modal-title {
            font-size: 1.5rem;
            font-weight: bold;
        }

        .close-modal {
            background: none;
            border: none;
            font-size: 1.5rem;
            cursor: pointer;
            color: var(--muted);
        }

        /* Game-specific styles */
        #snake-game canvas {
            display: block;
            margin: 0 auto;
            background: var(--elev-1);
            border-radius: var(--radius-sm);
        }

        .tic-tac-toe-board {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 8px;
            max-width: 300px;
            margin: 0 auto;
        }

        .ttt-cell {
            aspect-ratio: 1;
            background: var(--elev-1);
            border-radius: var(--radius-sm);
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 2.5rem;
            font-weight: bold;
            cursor: pointer;
        }

        .memory-board {
            display: grid;
            grid-template-columns: repeat(4, 1fr);
            gap: 10px;
            margin: 0 auto;
            max-width: 500px;
        }

        .memory-card {
            aspect-ratio: 1;
            background: var(--accent-primary);
            border-radius: var(--radius-sm);
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            transform-style: preserve-3d;
            transition: transform 0.6s var(--ease);
        }

        .memory-card.flipped {
            transform: rotateY(180deg);
        }

        .memory-card .front,
        .memory-card .back {
            position: absolute;
            width: 100%;
            height: 100%;
            backface-visibility: hidden;
            display: flex;
            align-items: center;
            justify-content: center;
            border-radius: var(--radius-sm);
        }

        .memory-card .back {
            background: var(--accent-primary);
            color: white;
            font-size: 1.5rem;
        }

        .memory-card .front {
            background: var(--elev-1);
            transform: rotateY(180deg);
        }

        .reaction-box {
            width: 100%;
            height: 200px;
            background: var(--elev-1);
            border-radius: var(--radius);
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 1.5rem;
            font-weight: bold;
            margin: var(--space-md) 0;
            cursor: pointer;
            transition: background 0.3s var(--ease);
        }

        .whack-grid {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 10px;
            margin: 0 auto;
            max-width: 400px;
        }

        .whack-hole {
            aspect-ratio: 1;
            background: var(--elev-1);
            border-radius: 50%;
            position: relative;
            overflow: hidden;
            cursor: pointer;
        }

        .whack-doodle {
            position: absolute;
            width: 80%;
            height: 80%;
            background: var(--accent-3);
            border-radius: 50%;
            bottom: -100%;
            left: 10%;
            transition: bottom 0.3s var(--ease);
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 1.5rem;
        }

        .whack-doodle.visible {
            bottom: 10%;
        }

        .guess-input {
            padding: var(--space-sm);
            border: 2px solid var(--elev-1);
            border-radius: var(--radius-sm);
            font-size: var(--body-size);
            margin-right: var(--space-sm);
            width: 80px;
            text-align: center;
        }

        .dice-container {
            display: flex;
            justify-content: center;
            gap: var(--space-md);
            margin: var(--space-md) 0;
        }

        .dice {
            width: 60px;
            height: 60px;
            background: var(--elev-1);
            border-radius: var(--radius-sm);
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 2rem;
            position: relative;
        }

        /* Responsive adjustments */
        @media (max-width: 768px) {
            :root {
                --h1-size: 2rem;
            }
            
            .games-grid {
                grid-template-columns: repeat(auto-fill, minmax(200px, 1fr));
            }
        }

        @media (max-width: 480px) {
            .games-grid {
                grid-template-columns: 1fr;
            }
            
            .app-header {
                flex-direction: column;
                gap: var(--space-sm);
            }
        }
    </style>
</head>
<body>
    <!-- ====== TEMPLATE (HTML) ====== -->
    <div class="app-container">
        <header class="app-header">
            <div class="logo">
                <div class="logo-icon">AD</div>
                <h1>ArcadeDoodle</h1>
            </div>
            <div class="header-controls">
                <button class="icon-button" id="sound-toggle" aria-label="Toggle sound">🔊</button>
                <button class="icon-button" id="theme-toggle" aria-label="Toggle theme">🌙</button>
                <button class="icon-button" id="profile-button" aria-label="View profile">👤</button>
            </div>
        </header>

        <main class="main-content">
            <div class="search-bar">
                <input type="text" class="search-input" placeholder="Search games..." id="search-input">
                <span class="search-icon">🔍</span>
            </div>

            <div class="games-grid" id="games-grid">
                <!-- Game tiles will be generated by JavaScript -->
            </div>

            <div id="game-container" class="game-container">
                <!-- Game content will be loaded here -->
            </div>
        </main>
    </div>

    <div class="toast-container" id="toast-container"></div>

    <div class="modal-overlay" id="onboarding-modal">
        <div class="modal">
            <div class="modal-header">
                <h2 class="modal-title">Welcome to ArcadeDoodle!</h2>
                <button class="close-modal" aria-label="Close modal">×</button>
            </div>
            <div class="modal-content">
                <p>🎮 Play six fun mini-games in one place</p>
                <p>🏆 Earn achievements and track your scores</p>
                <p>⚙️ Customize sound and theme in settings</p>
                <button class="btn" id="onboarding-dismiss">Let's play!</button>
            </div>
        </div>
    </div>

    <div class="modal-overlay" id="profile-modal">
        <div class="modal">
            <div class="modal-header">
                <h2 class="modal-title">Your Profile</h2>
                <button class="close-modal" aria-label="Close modal">×</button>
            </div>
            <div class="modal-content">
                <h3>Achievements</h3>
                <div id="achievements-list"></div>
                <h3>High Scores</h3>
                <div id="high-scores-list"></div>
            </div>
        </div>
    </div>

    <script>
        // ====== SCRIPTS ======
        // ArcadeDoodle - A playful mini-game arcade
        // Author: Your Name Here
        // Version: 1.0
        // Games: Smooth Snake, Tic-Tac-Toe, Memory Match, Reaction Tester, Whack-a-Doodle, Guess & Dice
        // TODO: Split into modules for production, add unit tests, convert to PWA, add analytics

        (function() {
            'use strict';
            
            // DOM helpers
            const qs = (selector, root = document) => root.querySelector(selector);
            const qsa = (selector, root = document) => Array.from(root.querySelectorAll(selector));
            const el = (tag, props = {}, children = []) => {
                const element = document.createElement(tag);
                Object.assign(element, props);
                children.forEach(child => element.appendChild(child));
                return element;
            };
            
            // Global state
            const state = {
                soundEnabled: true,
                theme: 'light',
                achievements: {},
                scores: {},
                games: [
                    {
                        id: 'snake',
                        title: 'Smooth Snake',
                        subtitle: 'Guide the snake to eat food',
                        doodle: '🐍',
                        color: 'var(--accent-2)'
                    },
                    {
                        id: 'tictactoe',
                        title: 'Tic-Tac-Toe',
                        subtitle: 'Classic X and O game',
                        doodle: '❌⭕',
                        color: 'var(--accent-primary)'
                    },
                    {
                        id: 'memory',
                        title: 'Memory Match',
                        subtitle: 'Find matching pairs',
                        doodle: '🧠',
                        color: 'var(--accent-3)'
                    },
                    {
                        id: 'reaction',
                        title: 'Reaction Tester',
                        subtitle: 'Test your reflexes',
                        doodle: '⚡',
                        color: 'var(--warn)'
                    },
                    {
                        id: 'whack',
                        title: 'Whack-a-Doodle',
                        subtitle: 'Whack the shapes',
                        doodle: '🔨',
                        color: 'var(--danger)'
                    },
                    {
                        id: 'guess',
                        title: 'Guess & Dice',
                        subtitle: 'Number guessing with dice',
                        doodle: '🎲',
                        color: 'var(--success)'
                    }
                ]
            };
            
            // Sound Manager using Web Audio API
            const SoundManager = (function() {
                let audioContext;
                let gainNode;
                
                try {
                    audioContext = new (window.AudioContext || window.webkitAudioContext)();
                    gainNode = audioContext.createGain();
                    gainNode.connect(audioContext.destination);
                    gainNode.gain.value = 0.5;
                } catch (e) {
                    console.warn('Web Audio API not supported');
                }
                
                function playTone(frequency, duration, type = 'sine') {
                    if (!state.soundEnabled || !audioContext) return;
                    
                    const oscillator = audioContext.createOscillator();
                    const envelope = audioContext.createGain();
                    
                    oscillator.type = type;
                    oscillator.frequency.value = frequency;
                    envelope.gain.value = 0;
                    
                    oscillator.connect(envelope);
                    envelope.connect(gainNode);
                    
                    oscillator.start();
                    
                    // Attack
                    envelope.gain.setValueAtTime(0, audioContext.currentTime);
                    envelope.gain.linearRampToValueAtTime(0.7, audioContext.currentTime + 0.01);
                    
                    // Release
                    envelope.gain.linearRampToValueAtTime(0, audioContext.currentTime + duration);
                    
                    oscillator.stop(audioContext.currentTime + duration);
                }
                
                return {
                    playClick() { playTone(523.25, 0.1); },
                    playSuccess() { playTone(1046.5, 0.3); },
                    playError() { playTone(220, 0.5, 'square'); },
                    playEat() { 
                        playTone(659.25, 0.1);
                        setTimeout(() => playTone(783.99, 0.1), 100);
                    },
                    playConfetti() {
                        for (let i = 0; i < 5; i++) {
                            setTimeout(() => {
                                playTone(800 + i * 200, 0.2);
                            }, i * 100);
                        }
                    },
                    setVolume(volume) {
                        if (gainNode) gainNode.gain.value = volume;
                    },
                    toggle() {
                        state.soundEnabled = !state.soundEnabled;
                        if (state.soundEnabled && audioContext) {
                            audioContext.resume();
                        }
                        return state.soundEnabled;
                    }
                };
            })();
            
            // Toast notification system
            const Toast = (function() {
                const container = qs('#toast-container');
                
                function show(message, type = 'default') {
                    const toast = el('div', { className: `toast ${type}` }, [
                        el('span', { textContent: message })
                    ]);
                    
                    container.appendChild(toast);
                    
                    // Remove after animation completes
                    setTimeout(() => {
                        if (toast.parentNode) {
                            container.removeChild(toast);
                        }
                    }, 3000);
                }
                
                return { show };
            })();
            
            // Confetti animation
            function createConfetti() {
                if (!state.soundEnabled) return;
                
                const colors = ['#4285f4', '#34a853', '#fbbc04', '#ea4335'];
                
                for (let i = 0; i < 30; i++) {
                    const confetti = el('div', { className: 'confetti' });
                    confetti.style.backgroundColor = colors[Math.floor(Math.random() * colors.length)];
                    confetti.style.left = Math.random() * 100 + 'vw';
                    confetti.style.animation = `confetti-fall ${Math.random() * 3 + 2}s linear forwards`;
                    confetti.style.width = Math.random() * 10 + 5 + 'px';
                    confetti.style.height = Math.random() * 10 + 5 + 'px';
                    
                    document.body.appendChild(confetti);
                    
                    setTimeout(() => {
                        if (confetti.parentNode) {
                            document.body.removeChild(confetti);
                        }
                    }, 5000);
                }
                
                SoundManager.playConfetti();
            }
            
            // Ripple effect for buttons
            function createRipple(event) {
                const button = event.currentTarget;
                const circle = el('div', { className: 'ripple' });
                
                const diameter = Math.max(button.clientWidth, button.clientHeight);
                const radius = diameter / 2;
                
                circle.style.width = circle.style.height = `${diameter}px`;
                circle.style.left = `${event.clientX - button.getBoundingClientRect().left - radius}px`;
                circle.style.top = `${event.clientY - button.getBoundingClientRect().top - radius}px`;
                
                button.appendChild(circle);
                
                setTimeout(() => {
                    if (circle.parentNode) {
                        button.removeChild(circle);
                    }
                }, 600);
            }
            
            // Initialize the app
            function init() {
                loadState();
                renderGameTiles();
                setupEventListeners();
                checkOnboarding();
                
                // Self test
                selfTest();
            }
            
            // Load state from localStorage
            function loadState() {
                try {
                    const savedState = localStorage.getItem('arcadedoodle.state');
                    if (savedState) {
                        const parsed = JSON.parse(savedState);
                        Object.assign(state, parsed);
                    }
                } catch (e) {
                    console.warn('Failed to load state from localStorage', e);
                }
                
                // Apply theme
                document.documentElement.classList.toggle('theme-dark', state.theme === 'dark');
                
                // Update sound button
                qs('#sound-toggle').textContent = state.soundEnabled ? '🔊' : '🔇';
            }
            
            // Save state to localStorage
            function saveState() {
                try {
                    localStorage.setItem('arcadedoodle.state', JSON.stringify({
                        soundEnabled: state.soundEnabled,
                        theme: state.theme,
                        achievements: state.achievements,
                        scores: state.scores
                    }));
                } catch (e) {
                    console.warn('Failed to save state to localStorage', e);
                }
            }
            
            // Render game tiles
            function renderGameTiles() {
                const grid = qs('#games-grid');
                grid.innerHTML = '';
                
                state.games.forEach(game => {
                    const tile = el('div', {
                        className: 'game-tile',
                        onclick: () => openGame(game.id)
                    }, [
                        el('div', { 
                            className: 'tile-doodle',
                            style: `color: ${game.color}`,
                            textContent: game.doodle
                        }),
                        el('h3', { className: 'tile-title', textContent: game.title }),
                        el('p', { className: 'tile-subtitle', textContent: game.subtitle })
                    ]);
                    
                    // Add ripple effect
                    tile.addEventListener('mousedown', createRipple);
                    
                    grid.appendChild(tile);
                });
            }
            
            // Set up event listeners
            function setupEventListeners() {
                // Theme toggle
                qs('#theme-toggle').addEventListener('click', () => {
                    state.theme = state.theme === 'light' ? 'dark' : 'light';
                    document.documentElement.classList.toggle('theme-dark', state.theme === 'dark');
                    saveState();
                    SoundManager.playClick();
                });
                
                // Sound toggle
                qs('#sound-toggle').addEventListener('click', () => {
                    const enabled = SoundManager.toggle();
                    qs('#sound-toggle').textContent = enabled ? '🔊' : '🔇';
                    saveState();
                    SoundManager.playClick();
                });
                
                // Profile button
                qs('#profile-button').addEventListener('click', () => {
                    showProfileModal();
                    SoundManager.playClick();
                });
                
                // Search input
                qs('#search-input').addEventListener('input', (e) => {
                    const searchTerm = e.target.value.toLowerCase();
                    filterGames(searchTerm);
                });
                
                // Onboarding modal
                qs('#onboarding-dismiss').addEventListener('click', () => {
                    hideOnboarding();
                    SoundManager.playClick();
                });
                
                qs('#onboarding-modal .close-modal').addEventListener('click', () => {
                    hideOnboarding();
                    SoundManager.playClick();
                });
                
                // Profile modal
                qs('#profile-modal .close-modal').addEventListener('click', () => {
                    qs('#profile-modal').classList.remove('active');
                    SoundManager.playClick();
                });
                
                // Pause games when window loses focus
                document.addEventListener('visibilitychange', () => {
                    if (document.hidden && window.activeGame && window.activeGame.pause) {
                        window.activeGame.pause();
                    }
                });
            }
            
            // Check if onboarding should be shown
            function checkOnboarding() {
                try {
                    const seen = localStorage.getItem('arcadedoodle.onboardingSeen');
                    if (!seen) {
                        qs('#onboarding-modal').classList.add('active');
                    }
                } catch (e) {
                    console.warn('Failed to check onboarding status', e);
                }
            }
            
            // Hide onboarding
            function hideOnboarding() {
                qs('#onboarding-modal').classList.remove('active');
                try {
                    localStorage.setItem('arcadedoodle.onboardingSeen', 'true');
                } catch (e) {
                    console.warn('Failed to save onboarding status', e);
                }
            }
            
            // Show profile modal
            function showProfileModal() {
                const achievementsList = qs('#achievements-list');
                const scoresList = qs('#high-scores-list');
                
                achievementsList.innerHTML = '';
                scoresList.innerHTML = '';
                
                // Add achievements
                if (Object.keys(state.achievements).length === 0) {
                    achievementsList.appendChild(el('p', { textContent: 'No achievements yet. Play games to earn some!' }));
                } else {
                    for (const [id, achieved] of Object.entries(state.achievements)) {
                        if (achieved) {
                            achievementsList.appendChild(el('div', { textContent: `✅ ${id}` }));
                        }
                    }
                }
                
                // Add high scores
                if (Object.keys(state.scores).length === 0) {
                    scoresList.appendChild(el('p', { textContent: 'No high scores yet. Play games to set some!' }));
                } else {
                    for (const [game, score] of Object.entries(state.scores)) {
                        scoresList.appendChild(el('div', { textContent: `${game}: ${score}` }));
                    }
                }
                
                qs('#profile-modal').classList.add('active');
            }
            
            // Filter games based on search term
            function filterGames(searchTerm) {
                const tiles = qsa('.game-tile');
                
                tiles.forEach(tile => {
                    const title = tile.querySelector('.tile-title').textContent.toLowerCase();
                    const subtitle = tile.querySelector('.tile-subtitle').textContent.toLowerCase();
                    
                    if (title.includes(searchTerm) || subtitle.includes(searchTerm)) {
                        tile.style.display = 'flex';
                    } else {
                        tile.style.display = 'none';
                    }
                });
            }
            
            // Open a game
            function openGame(gameId) {
                SoundManager.playClick();
                
                // Close current game if any
                if (window.activeGame && window.activeGame.destroy) {
                    window.activeGame.destroy();
                }
                
                const container = qs('#game-container');
                container.innerHTML = '';
                container.style.display = 'block';
                
                // Scroll to game
                container.scrollIntoView({ behavior: 'smooth' });
                
                // Initialize the selected game
                switch (gameId) {
                    case 'snake':
                        window.activeGame = SnakeGame(container);
                        break;
                    case 'tictactoe':
                        window.activeGame = TicTacToeGame(container);
                        break;
                    case 'memory':
                        window.activeGame = MemoryGame(container);
                        break;
                    case 'reaction':
                        window.activeGame = ReactionGame(container);
                        break;
                    case 'whack':
                        window.activeGame = WhackGame(container);
                        break;
                    case 'guess':
                        window.activeGame = GuessGame(container);
                        break;
                }
                
                if (window.activeGame && window.activeGame.init) {
                    window.activeGame.init();
                }
            }
            
            // Self test function
            function selfTest() {
                console.log('Running self-test...');
                
                // Test localStorage
                try {
                    localStorage.setItem('arcadedoodle.test', 'test');
                    localStorage.removeItem('arcadedoodle.test');
                    console.log('✅ localStorage is supported');
                } catch (e) {
                    console.warn('❌ localStorage is not supported');
                }
                
                // Test canvas
                const canvas = document.createElement('canvas');
                console.log(`✅ Canvas is ${canvas.getContext ? 'supported' : 'not supported'}`);
                
                // Test Web Audio API
                console.log(`✅ Web Audio API is ${window.AudioContext ? 'supported' : 'not supported'}`);
                
                console.log('Self-test completed');
            }
            
            // ====== GAME MODULES ======
            
            // Snake Game
            function SnakeGame(container) {
                let canvas, ctx;
                let gameInterval;
                let snake, food, direction, nextDirection;
                let score, highScore;
                let gridSize = 20;
                
                function init() {
                    // Create game UI
                    container.appendChild(el('div', { className: 'game-header' }, [
                        el('button', { 
                            className: 'btn btn-secondary',
                            onclick: () => { 
                                container.style.display = 'none';
                                SoundManager.playClick();
                            },
                            textContent: '← Back'
                        }),
                        el('h2', { className: 'game-title', textContent: 'Smooth Snake' }),
                        el('div', { className: 'game-controls' }, [
                            el('button', { 
                                className: 'btn',
                                onclick: restartGame,
                                textContent: 'Restart'
                            })
                        ])
                    ]));
                    
                    canvas = el('canvas', { width: 400, height: 400 });
                    container.appendChild(canvas);
                    ctx = canvas.getContext('2d');
                    
                    container.appendChild(el('div', { className: 'snake-info' }, [
                        el('p', { textContent: 'Score: ', className: 'score-display' }, [
                            el('span', { id: 'snake-score', textContent: '0' })
                        ]),
                        el('p', { textContent: 'High Score: ', className: 'high-score-display' }, [
                            el('span', { id: 'snake-high-score', textContent: '0' })
                        ])
                    ]));
                    
                    // Load high score
                    highScore = state.scores.snake || 0;
                    qs('#snake-high-score').textContent = highScore;
                    
                    // Initialize game state
                    restartGame();
                    
                    // Add keyboard controls
                    document.addEventListener('keydown', handleKeyDown);
                }
                
                function restartGame() {
                    // Reset game state
                    snake = [{x: 10, y: 10}];
                    direction = 'right';
                    nextDirection = 'right';
                    score = 0;
                    qs('#snake-score').textContent = score;
                    
                    // Generate food
                    generateFood();
                    
                    // Clear previous interval
                    if (gameInterval) clearInterval(gameInterval);
                    
                    // Start game loop
                    gameInterval = setInterval(gameLoop, 150);
                    
                    // Draw initial state
                    draw();
                }
                
                function gameLoop() {
                    // Update direction
                    direction = nextDirection;
                    
                    // Move snake
                    const head = {...snake[0]};
                    
                    switch(direction) {
                        case 'up': head.y--; break;
                        case 'down': head.y++; break;
                        case 'left': head.x--; break;
                        case 'right': head.x++; break;
                    }
                    
                    // Check for collisions
                    if (head.x < 0 || head.x >= canvas.width/gridSize || 
                        head.y < 0 || head.y >= canvas.height/gridSize ||
                        snake.some(segment => segment.x === head.x && segment.y === head.y)) {
                        gameOver();
                        return;
                    }
                    
                    // Add new head
                    snake.unshift(head);
                    
                    // Check for food
                    if (head.x === food.x && head.y === food.y) {
                        score += 10;
                        qs('#snake-score').textContent = score;
                        SoundManager.playEat();
                        generateFood();
                        
                        // Increase speed every 3 foods
                        if (score % 30 === 0) {
                            clearInterval(gameInterval);
                            gameInterval = setInterval(gameLoop, Math.max(50, 150 - score/3));
                        }
                    } else {
                        // Remove tail
                        snake.pop();
                    }
                    
                    // Draw updated game state
                    draw();
                }
                
                function draw() {
                    // Clear canvas
                    ctx.fillStyle = '#f1f3f4';
                    ctx.fillRect(0, 0, canvas.width, canvas.height);
                    
                    // Draw food
                    ctx.fillStyle = '#ea4335';
                    ctx.fillRect(food.x * gridSize, food.y * gridSize, gridSize, gridSize);
                    
                    // Draw snake
                    ctx.fillStyle = '#34a853';
                    snake.forEach(segment => {
                        ctx.fillRect(segment.x * gridSize, segment.y * gridSize, gridSize, gridSize);
                    });
                }
                
                function generateFood() {
                    food = {
                        x: Math.floor(Math.random() * (canvas.width / gridSize)),
                        y: Math.floor(Math.random() * (canvas.height / gridSize))
                    };
                    
                    // Make sure food doesn't appear on snake
                    if (snake.some(segment => segment.x === food.x && segment.y === food.y)) {
                        generateFood();
                    }
                }
                
                function handleKeyDown(e) {
                    switch(e.key) {
                        case 'ArrowUp':
                            if (direction !== 'down') nextDirection = 'up';
                            break;
                        case 'ArrowDown':
                            if (direction !== 'up') nextDirection = 'down';
                            break;
                        case 'ArrowLeft':
                            if (direction !== 'right') nextDirection = 'left';
                            break;
                        case 'ArrowRight':
                            if (direction !== 'left') nextDirection = 'right';
                            break;
                    }
                }
                
                function gameOver() {
                    clearInterval(gameInterval);
                    
                    // Update high score if needed
                    if (score > highScore) {
                        highScore = score;
                        state.scores.snake = highScore;
                        saveState();
                        qs('#snake-high-score').textContent = highScore;
                        
                        // Show celebration
                        createConfetti();
                        Toast.show('New high score!', 'success');
                    }
                    
                    // Draw game over message
                    ctx.fillStyle = 'rgba(0, 0, 0, 0.7)';
                    ctx.fillRect(0, 0, canvas.width, canvas.height);
                    
                    ctx.fillStyle = 'white';
                    ctx.font = '30px Arial';
                    ctx.textAlign = 'center';
                    ctx.fillText('GAME OVER', canvas.width/2, canvas.height/2 - 15);
                    ctx.font = '20px Arial';
                    ctx.fillText('Press Restart to play again', canvas.width/2, canvas.height/2 + 15);
                }
                
                function destroy() {
                    clearInterval(gameInterval);
                    document.removeEventListener('keydown', handleKeyDown);
                }
                
                return { init, destroy };
            }
            
            // Tic-Tac-Toe Game
            function TicTacToeGame(container) {
                // Implementation would go here
                return { 
                    init: function() {
                        container.innerHTML = '<h2>Tic-Tac-Toe Game</h2><p>Implementation would go here</p>';
                    },
                    destroy: function() {}
                };
            }
            
            // Memory Game
            function MemoryGame(container) {
                // Implementation would go here
                return { 
                    init: function() {
                        container.innerHTML = '<h2>Memory Game</h2><p>Implementation would go here</p>';
                    },
                    destroy: function() {}
                };
            }
            
            // Reaction Game
            function ReactionGame(container) {
                // Implementation would go here
                return { 
                    init: function() {
                        container.innerHTML = '<h2>Reaction Game</h2><p>Implementation would go here</p>';
                    },
                    destroy: function() {}
                };
            }
            
            // Whack-a-Doodle Game
            function WhackGame(container) {
                // Implementation would go here
                return { 
                    init: function() {
                        container.innerHTML = '<h2>Whack-a-Doodle Game</h2><p>Implementation would go here</p>';
                    },
                    destroy: function() {}
                };
            }
            
            // Guess & Dice Game
            function GuessGame(container) {
                // Implementation would go here
                return { 
                    init: function() {
                        container.innerHTML = '<h2>Guess & Dice Game</h2><p>Implementation would go here</p>';
                    },
                    destroy: function() {}
                };
            }
            
            // Initialize the app when DOM is loaded
            if (document.readyState === 'loading') {
                document.addEventListener('DOMContentLoaded', init);
            } else {
                init();
            }
            
            // Expose for debugging
            window.ArcadeDoodle = {
                openGame,
                state
            };
        })();
    </script>
</body>
</html>
